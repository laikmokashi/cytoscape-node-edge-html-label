!function(){"use strict";const t=function(t,e){if("function"!=typeof e)throw new TypeError("predicate must be a function");const i=t.length>>>0,n=arguments[1];let o;for(let s=0;s<i;s++)if(o=t[s],e.call(n,o,s,t))return o};class e{constructor({node:t,position:e=null,data:i=null,_cy:n},o){this._params=o,this.updateParams(o),this._node=t,this._cy=n,this.initStyles(o.cssClass),i&&this.updateData(i),e&&i.source&&i.target?this.updateEdgePosition(e,i.id):e&&this.updatePosition(e)}updateParams({tpl:t=(()=>""),cssClass:e=null,halign:i="center",valign:n="center",halignBox:o="center",valignBox:s="center"}){const a={top:-.5,left:-.5,center:0,right:.5,bottom:.5};this._align=[a[i],a[n],100*(a[o]-.5),100*(a[s]-.5)],this.tpl=t,null==this._params.edgehtmlTiltPoint1&&(this._params.edgehtmlTiltPoint1="sourceNode"),null==this._params.edgehtmlTiltPoint2&&(this._params.edgehtmlTiltPoint2="targetNode")}updateData(t){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);const e=(new DOMParser).parseFromString(this.tpl(t),"text/html").body.children;for(let t=0;t<e.length;++t){const i=e[t];this._node.appendChild(i)}}getNode(){return this._node}updatePosition(t){this._renderPosition(t)}updateEdgePosition(t,e){this._renderEdgePosition(t,e)}initStyles(t){this._node.style.position="absolute",t&&t.length&&this._node.classList.add(t)}_renderPosition(t){const e=this._position,i=t.x+this._align[0]*t.w,n=t.y+this._align[1]*t.h;if(!e||e[0]!==i||e[1]!==n){this._position=[i,n];const t=`translate(${this._align[2]}%,${this._align[3]}%) `+`translate(${i.toFixed(2)}px,${n.toFixed(2)}px) `,e=this._node.style;e.webkitTransform=t,e.msTransform=t,e.transform=t}}_renderEdgePosition(t,e){const i=this._cy.$("#"+e),n=i.controlPoints();let o,s;if(n?.length&&null!=this._params?.edgehtmlTiltPoint1&&"number"==typeof this._params.edgehtmlTiltPoint1)try{o=n[this._params.edgehtmlTiltPoint1]}catch(t){console.error("edgehtmlTiltPoint1 is not a valid control point number")}else o=null!=this._params?.edgehtmlTiltPoint1&&"targetNode"==this._params.edgehtmlTiltPoint1?i.targetEndpoint():i.sourceEndpoint();if(n?.length&&null!=this._params?.edgehtmlTiltPoint2&&"number"==typeof this._params.edgehtmlTiltPoint2)try{s=n[this._params.edgehtmlTiltPoint2]}catch(t){console.error("edgehtmlTiltPoint2 is not a valid control point number")}else s=null!=this._params?.edgehtmlTiltPoint2&&"sourceNode"==this._params.edgehtmlTiltPoint2?i.sourceEndpoint():i.targetEndpoint();var a=180*Math.atan2(s.y-o.y,s.x-o.x)/Math.PI;a>90?a=a-90-90:a<-90&&(a=90+(a+90));const d=this._position,r=t.x+this._align[0]*t.w,l=t.y+this._align[1]*t.h;let h="none";if(!d||d[0]!==r||d[1]!==l){this._position=[r,l],h=0==r||0==l?"none":"block";const t=`translate(${this._align[2]}%,${this._align[3]}%) `+`translate(${r.toFixed(2)}px,${l.toFixed(2)}px) `+`rotate(${a}deg)`,e=this._node.style;e.webkitTransform=t,e.msTransform=t,e.transform=t,e.display=h}}}class i{constructor(t,e){this._node=t,this._elements={},this._cy=e}addOrUpdateElem(t,i,n={},o,s){const a=this._elements[t];if(a){this._param=i,a.updateParams(i),a.updateData(n.data),"node"==s?a.updatePosition(n.position):a.updateEdgePosition(n.position,t);const e=new Event("start");document.dispatchEvent(e)}else{const s=document.createElement("div");var d=new MutationObserver((function(t){if(document.contains(s)){const t=o.nodes(`#${s.children[0].id.split(":")[1]}`);t.data("htmlNode",s);try{t.style({width:s.offsetWidth/.6,height:s.offsetHeight/.6})}catch(t){console.warn("cytoscape.js-html-node: unable to create html label",t)}d.disconnect()}}));d.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),this._node.appendChild(s),this._elements[t]=new e({node:s,data:n.data,position:n.position,_cy:o},i)}}removeElemById(t){this._elements[t]&&(this._node.removeChild(this._elements[t].getNode()),delete this._elements[t])}updateElemPosition(t,e){const i=this._cy.$("#"+t);let n=!1;i.length&&(n=!!i.isEdge());const o=this._elements[t];o&&n?o.updateEdgePosition(e,t):o&&o.updatePosition(e)}updatePanZoom({pan:t,zoom:e}){const i=`translate(${t.x}px,${t.y}px) scale(${e})`,n=this._node.style,o="top left";n.webkitTransform=i,n.msTransform=i,n.transform=i,n.webkitTransformOrigin=o,n.msTransformOrigin=o,n.transformOrigin=o}}function n(e,n,o){const s=n&&"object"==typeof n?n:[],a=function(){const t=e.container(),n=document.createElement("div"),s=t.querySelector("canvas"),a=t.querySelector("[class^='cy-node-html']");a&&s.parentNode.removeChild(a);const d=n.style;d.position="absolute",d["z-index"]=9,d.width="500px",d.margin="0px",d.padding="0px",d.border="0px",d.outline="0px",d.outline="0px",o&&!0!==o.enablePointerEvents&&(d["pointer-events"]="none");return s.parentNode.appendChild(n),new i(n,e)}();return e.one("render",(t=>{!function({cy:t}){s.forEach((e=>{t.elements(e.query).forEach((i=>{i.isNode()?a.addOrUpdateElem(i.id(),e,{position:l(i),data:i.data()},t,"node"):i.isEdge()&&a.addOrUpdateElem(i.id(),e,{position:h(i),data:i.data()},t,"edge")}))}))}(t),r(t)})),e.on("add",(i=>{!function(e,i){const n=e.target,o=t(s.slice().reverse(),(t=>n.is(t.query)));o&&(n.isNode()?a.addOrUpdateElem(n.id(),o,{position:l(n),data:n.data()},i,"node"):n.isEdge()&&a.addOrUpdateElem(n.id(),o,{position:h(n),data:n.data()},i,"edge"))}(i,e)})),e.on("layoutstop",(function({cy:t}){s.forEach((e=>{t.elements(e.query).forEach((t=>{t.isNode()?a.updateElemPosition(t.id(),l(t)):t.isEdge()&&a.updateElemPosition(t.id(),h(t))}))}))})),e.on("remove",(function(t){a.removeElemById(t.target.id())})),e.on("data",(t=>d(t,e))),e.on("style",(t=>d(t,e))),e.on("pan zoom",r),e.on("position bounds",(function(t){a.updateElemPosition(t.target.id(),l(t.target));const i=e.$("#"+t.target.id()).connectedEdges();i.length>0&&i.forEach((t=>{a.updateElemPosition(t.id(),h(t))}))})),e;function d(e,i){const n=e.target,o=t(s.slice().reverse(),(t=>n.is(t.query)));o&&!n.removed()?n.isNode()?a.addOrUpdateElem(n.id(),o,{position:l(n),data:n.data()},i,"node"):n.isEdge()&&a.addOrUpdateElem(n.id(),o,{position:h(n),data:n.data()},i,"edge"):a.removeElemById(n.id())}function r({cy:t}){a.updatePanZoom({pan:t.pan(),zoom:t.zoom()})}function l(t){return{w:t.width(),h:t.height(),x:t.position("x"),y:t.position("y")}}function h(t){let e;return e=n&&n[0]?.edgehtmlLocation?"start"==n[0]?.edgehtmlLocation?{w:t.width(),h:t.height(),x:t.sourceEndpoint().x,y:t.sourceEndpoint().y}:"end"==n[0]?.edgehtmlLocation?{w:t.width(),h:t.height(),x:t.targetEndpoint().x,y:t.targetEndpoint().y}:{w:t.width(),h:t.height(),x:t.midpoint().x,y:t.midpoint().y}:{w:t.width(),h:t.height(),x:t.midpoint().x,y:t.midpoint().y},e}}const o=function(t){t&&t("core","nodeHtmlLabel",(function(t,e){return n(this,t,e)}))};"undefined"!=typeof module&&module.exports?module.exports=function(t){o(t)}:"undefined"!=typeof define&&define.amd&&define("cytoscape-nodeHtmlLabel",(function(){return o})),"undefined"!=typeof cytoscape&&o(cytoscape)}();